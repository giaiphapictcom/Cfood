@using V308CMS.Helpers.Url
<div class="modal-dialog popup-container popup_content" style="width: 500px !important; height: auto;">
    <div class="modal-content">
        <div class="popup-header-read">
            <div class="popup-header-title">Đăng ký tài khoản</div>
            <a class="popup-header-close close" data-dismiss="modal" aria-hidden="true">
                <i class="fa fa-times" style="margin-top: -2px;"></i>
            </a>
        </div>
        <div class="modal-body">
            <div class="inner-popup-wrap login" style="margin-bottom: 20px; color: #111; width: 100%;">
                <form  action="@Url.AccounRegisterAjaxUrl()" id="register_form" method="post">
                    <div class="body">
                        <div class="form-group" id="divMessageLogin" style="display: none;">
                            <div class="col-md-12" style="margin-top: 10px; margin-bottom: 15px; text-align: left; font-size: 15px; color: red;">
                                <span class="error font-bold" style="font-size: 13px;" id="spanMessageLogin"></span>
                            </div>
                        </div>
                        <div class="body-inner" style="padding-bottom: 10px;">
                            <label>Email*</label>
                            <input class="form-control" id="email" name="email" type="text" placeholder="Nhập email đăng ký tài khoản."/>
                            <label>Mật khẩu* <span>Tối thiểu 6 ký tự</span></label>
                            <input id="password" name="password" type="password" placeholder="Nhập mật khẩu đăng ký tài khoản."/>
                            <label>Nhập lại Mật khẩu* <span>Tối thiểu 6 ký tự</span></label>
                            <input class="form-control" id="confirmpassword" name="confirmpassword" type="password" placeholder="Nhập mật khẩu xác nhận đăng ký tài khoản."/>
                            <label for="captcha">Mã xác thực*</label>
                            <input id="captcha" name="captcha" type="text" placeholder="Nhập mã xác thực" style="width: 135px;"/>                                                       
                            <img class="img-captcha" src="@Url.RegisterCaptchaUrl()" alt="captcha" />
                            <span class="refresh" onclick="showCaptcha()">
                                <img src="/Content/themes/myshopify/images/refresh.png" alt="Lấy mã xác thực mới" style="cursor: pointer"/>
                            </span>                             
                            <br/>
                            <label>&nbsp;</label>
                            <input id="btnRegister" type="submit" class="btn-sign-in" value="Đăng ký"/>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<script type="text/javascript">
    function showCaptcha() {
        $(".img-captcha").removeAttr("src");
        $(".img-captcha").attr('src', '/Captcha/RegisterCaptcha?timestamp =' + new Date().getTime());
    }
    function validateEmail(email) {
        var re = /^(([^<>()\[\]\\.,;:\s@@"]+(\.[^<>()\[\]\\.,;:\s@@"]+)*)|(".+"))@@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;
        return re.test(email);
    }
    $(function() {
        function showMessage(message, isSuccess) {
            $('#spanMessageLogin').text(message);
            if (isSuccess === 1) {
                if (!$('#spanMessageLogin').hasClass('success-message')) {
                    $('#spanMessageLogin').addClass('success-message');
                }
            } else {
                if (!$('#spanMessageLogin').hasClass('error')) {
                    $('#spanMessageLogin').addClass('error');
                }
            }
            $('#divMessageLogin').show();
        }

        $("#btnRegister").click(function(e) {
            e.preventDefault();
            if ($("#email").val() === "") {
                showMessage("Vui lòng nhập email.");
                $('#email').focus();
                return false;
            }
            if (!validateEmail($("#email").val())) {
                showMessage("Địa chỉ email không hợp lệ.");
                $('#email').focus();
                return false;
            }
            if ($("#password").val() === "") {
                showMessage("Vui lòng nhập mật khẩu.");
                $('#password').focus();
                return false;
            }
            if ($("#password").val().length<6) {
                showMessage("Mật khẩu tối thiểu 6 ký tự.");
                $('#password').focus();
                return false;
            }
            if ($("#password").val() !== $("#confirmpassword").val()) {
                showMessage("Mật khẩu xác nhận không đúng.");
                $('#password').focus();
                return false;
            }
            $.post("@Url.AccounRegisterAjaxUrl()", { email: $("#email").val(), password: $("#password").val(), confirmpassword: $("#confirmpassword").val(), captcha: $("#captcha").val() }, function(response) {
                if (response.code === 0) {
                    showMessage(response.message);
                    showCaptcha();
                    return false;
                }
                showMessage(response.message, 1);
                showCaptcha();
                $.get("@Url.PopupLoginUrl()", function (response) {
                    jQuery('#modalPopUp').html(response);
                    jQuery('#modalPopUp').modal({ show: true });
                });
                return true;
            });

        });

    });

</script>